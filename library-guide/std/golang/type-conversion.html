
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="robots" content="index, follow">
<meta name='description' content='aardio ç¼–ç¨‹è¯­è¨€æ–‡æ¡£ - Go / aardio åŸç”Ÿç±»å‹è½¬æ¢'>
<meta http-equiv='content-language' content='zh-cn'>
<title>aardio ç¼–ç¨‹è¯­è¨€æ–‡æ¡£ - Go / aardio åŸç”Ÿç±»å‹è½¬æ¢</title> 
<link rel="stylesheet" href="../../../css/markdown.css" tppabs="https://www.aardio.com/zh-cn/doc/css/markdown.css">
<script src="../../../js/prism.js" tppabs="https://www.aardio.com/zh-cn/doc/js/prism.js"></script>
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css">
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css">
</head>
<body class="markdown-body"><a id="back-to-home" href="../../../index.htm" tppabs="https://www.aardio.com/zh-cn/doc/" title="aardio ç¼–ç¨‹è¯­è¨€æ–‡æ¡£é¦–é¡µ"><i class="fas fa-home" id="home-icon"></i><i class="fas fa-robot" id="ai-icon" style="display: none;"></i><span id="aardio-document-home">aardio æ–‡æ¡£</span></a>
<h1>Go / aardio åŸç”Ÿç±»å‹è½¬æ¢</h1>

<p>aardio å¯ä»¥ä½¿ç”¨ table å®šä¹‰ç»“æ„ä½“(struct)ï¼Œåœ¨ç»“æ„ä½“ä¸­å¯ä»¥å®šä¹‰åŸç”Ÿç±»å‹ã€‚</p>

<p>è¯·å‚è€ƒï¼š</p>

<ul>
<li><a href="../../builtin/raw/api.html" tppabs="https://www.aardio.com/zh-cn/doc/library-guide/builtin/raw/api.html">raw åº“</a> </li>
<li><a href="../../builtin/raw/datatype.html" tppabs="https://www.aardio.com/zh-cn/doc/library-guide/builtin/raw/datatype.html">åŸç”Ÿæ•°æ®ç±»å‹</a></li>
</ul>

<h2>aardioï¼ŒC è¯­è¨€ï¼Œcgoï¼ŒGo ç±»å‹å¯¹åº”å…³ç³»</h2>

<table><thead>
<tr>
<th>aardio</th>
<th>C è¯­è¨€</th>
<th>cgo</th>
<th>Go</th>
</tr>
</thead><tbody>
<tr>
<td>BYTE</td>
<td>char</td>
<td>C.char</td>
<td>byte,bool</td>
</tr>
<tr>
<td>byte</td>
<td>singed char</td>
<td>C.schar</td>
<td>int8</td>
</tr>
<tr>
<td>BYTE</td>
<td>unsigned char</td>
<td>C.uchar</td>
<td>uint8,byte</td>
</tr>
<tr>
<td>word</td>
<td>short</td>
<td>C.short</td>
<td>int16</td>
</tr>
<tr>
<td>WORD</td>
<td>unsigned short</td>
<td>C.ushort</td>
<td>uint16</td>
</tr>
<tr>
<td>int</td>
<td>int</td>
<td>C.int</td>
<td>int32,rune</td>
</tr>
<tr>
<td>INT</td>
<td>unsigned int</td>
<td>C.uint</td>
<td>uint32</td>
</tr>
<tr>
<td>int</td>
<td>long</td>
<td>C.long</td>
<td>int32</td>
</tr>
<tr>
<td>INT</td>
<td>unsigned long</td>
<td>C.ulong</td>
<td>uint32</td>
</tr>
<tr>
<td>long</td>
<td>long long</td>
<td>C.longlong</td>
<td>int64</td>
</tr>
<tr>
<td>LONG</td>
<td>unsigned long long</td>
<td>C.ulonglong</td>
<td>uint64</td>
</tr>
<tr>
<td>float</td>
<td>float</td>
<td>C.float</td>
<td>float32</td>
</tr>
<tr>
<td>double</td>
<td>double</td>
<td>C.double</td>
<td>float64</td>
</tr>
<tr>
<td>INT</td>
<td>size_t</td>
<td>C.size_t</td>
<td>uint</td>
</tr>
<tr>
<td>pointer</td>
<td>void *</td>
<td></td>
<td>unsafe.Pointer</td>
</tr>
</tbody></table>

<p>è¦ç‰¹åˆ«æ³¨æ„ Go çš„ bool ç±»å‹åªæœ‰ 1 ä¸ªå­—èŠ‚ï¼Œç›¸å½“äº aardio ä¸­çš„ BYTEï¼Œè€Œ aardio ä¸­çš„ bool ç±»å‹åˆ™æ˜¯ 32 ä½ 4 ä¸ªå­—èŠ‚ï¼Œç›¸å½“äº WinAPI å®šä¹‰çš„ BOOL ç±»å‹ã€‚</p>

<p>aardio è°ƒç”¨ Go ç¤ºä¾‹ï¼Œé¦–å…ˆè°ƒç”¨ Go ç¼–è¯‘å™¨ç”Ÿæˆ DLL æ–‡ä»¶ï¼š </p>

<pre><code class="aardio language-aardio">//è°ƒç”¨ç¼–è¯‘åçš„ DLL ä¸éœ€è¦å¯¼å…¥æ­¤ä¸º
import golang;

//åˆ›å»º Go ç¼–è¯‘å™¨ï¼ˆ ä»…ä»…è°ƒç”¨ç¼–è¯‘åçš„ DLL ä¸éœ€è¦ ï¼‰ã€‚ 
var go = golang();

//Go æºç ï¼šä¸ aardio ä¸€æ ·é»˜è®¤ UTF-8 ç¼–ç 
go.main = /**********
package main

import &quot;C&quot; //å•ç‹¬å¯¼å…¥è¿™å¥å¯ç”¨ CGO
import &quot;fmt&quot; //https://pkg.go.dev/fmt
import &quot;unsafe&quot; //https://pkg.go.dev/unsafe

type MyStruct struct { 
    Int8Field   int8
    Int16Field  int16
    Int32Field  int32
    Int64Field  int64
    UintField   uint
    Uint8Field  uint8
    Uint16Field uint16
    Uint32Field uint32
    Uint64Field uint64
    Float32Field float32
    Float64Field float64
    pStr *C.char 
}

//åœ¨æ³¨é‡Šé‡Œç”¨ export å£°æ˜ä¸º DLL å¯¼å‡ºå‡½æ•°  
//export SetStruct
func SetStruct(p uintptr) {  
    // aardio ç»“æ„ä½“è½¬æ¢ä¸º Go ç»“æ„ä½“
    st := (*MyStruct)(unsafe.Pointer(p)) 
    st.Int8Field = 8

    //Go ç”¨ fmt.Println æ‰“å°å˜é‡å¾ˆæ–¹ä¾¿ï¼Œå¯ä¼ å…¥å¤šä¸ªä»»æ„ç±»å‹çš„å‚æ•°ã€‚ 
    fmt.Println( &quot;åœ¨ Go ä¸­æ‰“å°ç»“æ„ä½“ï¼š&quot;,st );

    var str = C.GoString(st.pStr);
    fmt.Printf(&quot;Go says: %s!\n&quot;, str) 
}

//åˆå§‹åŒ–å‡½æ•°ï¼Œå¯ä»¥é‡å¤å†™å¤šä¸ª
func init() { }

//å¿…é¡»å†™ä¸ªç©ºçš„å…¥å£å‡½æ•°ï¼Œå®é™…ä¸ä¼šæ‰§è¡Œ
func main() {} 
**********/

//ä¸Šé¢çš„ go.main ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æ–‡ä»¶ï¼Œç„¶åç¼–è¯‘ Go æºç ç”ŸæˆåŒå DLL æ–‡ä»¶
go.buildShared(&quot;/.go/testStruct.go&quot;);
</code></pre>

<p>ç„¶ååœ¨ aardio ä¸­è°ƒç”¨ä¸Šé¢ç”Ÿæˆçš„ DLL:  </p>

<pre><code class="aardio language-aardio">import console.int;
//åŠ è½½ Go ç¼–è¯‘çš„ DLLï¼Œæ³¨æ„è¦æŒ‡å®š cdecl è°ƒç”¨çº¦å®šã€‚ 
var goDll = raw.loadDll($&quot;/.go/testStruct.dll&quot;,,&quot;cdecl&quot;);
//å¦‚æœå·²ç»ç”Ÿæˆ DLLï¼Œç”¨$æ“ä½œç¬¦å¯ä»¥åµŒå…¥ DLL åˆ°ä»£ç ä¸­å®ç°å†…å­˜åŠ è½½ï¼ˆå‘å¸ƒåä¸éœ€è¦å¸¦ DLL æ–‡ä»¶ï¼‰ã€‚
//å£°æ˜ç»“æ„ä½“
class myStruct {
    byte Int8Field;//Goç±»å‹ int8
    word Int16Field;//Goç±»å‹ int16
    int32 Int32Field;//Goç±»å‹ int32
    long64 Int64Field;//Goç±»å‹ int64 
    BYTE Uint8Field;//Goç±»å‹ uint8
    WORD Uint16Field;//Goç±»å‹ uint16
    INT32 Uint32Field;//Goç±»å‹ uint32
    LONG64 Uint64Field;//Goç±»å‹ uint64
    float Float32Field;//Goç±»å‹ float32
    double Float64Field;//Goç±»å‹ float64
    string pStr = &quot;è¿™æ˜¯ aardio å­—ç¬¦ä¸²&quot;
}

//åˆ›å»ºç»“æ„ä½“
var struct = myStruct();

//è°ƒç”¨ Go å‡½æ•°ï¼Œä¼ ç»“æ„ä½“ï¼ˆç»“æ„ä½“æ€»æ˜¯ä¼ å€ï¼‰
goDll.SetStruct(struct); 

//æ‰“å°ç»“æ„ä½“
console.dumpJson(struct);
</code></pre>

<p>è°ƒç”¨ Go å†™çš„ DLL è¯·æ³¨æ„ï¼š  </p>

<ol>
<li><p>åŠ è½½ Go å†™çš„ DLL ç„¶åè¿…é€Ÿï¼ˆå‡ ç§’ä»¥å†…ï¼‰é€€å‡ºï¼ŒGo ç¨‹åºå¯èƒ½ä¼šå´©æºƒã€‚<br>
è¿™ä¸æ˜¯å› ä¸ºä½ å†™çš„ä»£ç æœ‰ä»»ä½•é—®é¢˜ï¼Œè€Œæ˜¯ Go éœ€è¦é¢å¤–å¯åŠ¨è¿è¡Œæ—¶ï¼Œæ— æ³•åº”ä»˜è¿™ç§å¿«é€Ÿé€€å‡ºçš„æƒ…å†µã€‚<br>
è¿™æ—¶åœ¨åé¢åŠ ä¸€å¥ thread.delay(2000) å°±å¯ä»¥è§£å†³ã€‚  </p>

<p>å®é™…ä¸Šé™¤äº†å†™æµ‹è¯•ä»£ç ï¼Œä¸€èˆ¬ä¹Ÿä¸ä¼šæ‰“å¼€ä¸€ä¸ªç¨‹åºå°±åœ¨å‡ ç§’å†…é€€å‡ºã€‚<br>
æ‰€ä»¥ç¨åŠ æ³¨æ„ä¸€ä¸‹ï¼Œé¿å…è¿™ä¸ªé—®é¢˜å¹¶ä¸éš¾ã€‚  </p>

<p>åªæœ‰ Go å†™çš„ DLL æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå…¶ä»–è¯­è¨€å†™çš„ DLL æ²¡è¿™ç§é—®é¢˜ã€‚  </p></li>
<li><p>åœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…ï¼Œ Go å†™çš„åŒä¸€ä¸ª DLL åº”å½“åªåŠ è½½ä¸€æ¬¡ã€‚<br>
å½“ç„¶åœ¨ DLL æ²¡æœ‰å¸è½½å‰ï¼Œåå¤è°ƒç”¨ raw.loadDll() åªæ˜¯å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œä¸ä¼šé‡å¤åŠ è½½ DLLã€‚  </p>

<p>å¦‚æœå¤šçº¿ç¨‹å†…å­˜åŠ è½½åŒä¸€ä¸ª Go å†™çš„ DLL å°±ä¼šåŠ è½½å¤šä¸ªä¸åŒçš„å‰¯æœ¬ã€‚<br>
è¿™æ—¶å€™åŠ¡å¿…åœ¨ raw.loadDll(&quot;go.dll&quot;,&quot;å…±äº«åç§°&quot;) çš„ç¬¬ 2 ä¸ªå‚æ•°æŒ‡å®šå…±äº«åç§°ï¼Œä»¥é¿å…é‡å¤åŠ è½½ã€‚  </p></li>
<li><p>è¦æ³¨æ„åœ¨ aardio ä¸­ DLL ä¸åº”å½“ä½œä¸ºçº¿ç¨‹å‚æ•°ä¼ é€’ï¼Œå®é™…ä¸Šä¹Ÿæ²¡å¿…è¦è¿™æ ·åšã€‚  </p>

<p>åªè¦ç”¨ raw.loadDll() åŠ è½½åŒå DLL (æˆ–åŠ è½½ç›¸åŒå…±äº«åç§°çš„å†…å­˜ DLL) æ˜¯ä¸ä¼šé‡å¤åŠ è½½çš„ã€‚</p></li>
</ol>

<p><a href="javascript:if(confirm('https://www.aardio.com/zh-cn/doc/library-guide/std/golang/type-conversion.md  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª Ëü²»ÔÚÏîÄ¿ÎÄ¼şÀàĞÍ¹æ·¶ÄÚ¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.aardio.com/zh-cn/doc/library-guide/std/golang/type-conversion.md'" tppabs="https://www.aardio.com/zh-cn/doc/library-guide/std/golang/type-conversion.md">Markdown æ ¼å¼</a></p>

</body> 
</html>