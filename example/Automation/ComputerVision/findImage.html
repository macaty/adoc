
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="robots" content="index, follow">
<meta name='description' content='aardio ç¼–ç¨‹è¯­è¨€èŒƒä¾‹ - æ‰¾å›¾ä»£ç ç”Ÿæˆå™¨'>
<meta http-equiv='content-language' content='zh-cn'>
<title>aardio ç¼–ç¨‹è¯­è¨€èŒƒä¾‹ - æ‰¾å›¾ä»£ç ç”Ÿæˆå™¨</title> 
<link rel="stylesheet" href="../../../css/markdown.css" tppabs="https://www.aardio.com/zh-cn/doc/css/markdown.css">
<script src="../../../js/prism.js" tppabs="https://www.aardio.com/zh-cn/doc/js/prism.js"></script>
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css">
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css">
</head>
<body class="markdown-body"><a id="back-to-home" href="../../../index.htm" tppabs="https://www.aardio.com/zh-cn/doc/" title="aardio ç¼–ç¨‹è¯­è¨€æ–‡æ¡£é¦–é¡µ"><i class="fas fa-home" id="home-icon"></i><i class="fas fa-robot" id="ai-icon" style="display: none;"></i><span id="aardio-document-home">aardio æ–‡æ¡£</span></a>
<h1>aardio èŒƒä¾‹: æ‰¾å›¾ä»£ç ç”Ÿæˆå™¨</h1><pre><code class="aardio language-aardio">//æ‰¾å›¾ä»£ç ç”Ÿæˆå™¨
import win.ui;
/*DSG{{*/
var winform = win.form(text=&quot;æ‰¾å›¾ä»£ç ç”Ÿæˆå™¨&quot;;right=454;bottom=403)
winform.add(
btnSnap={cls=&quot;button&quot;;text=&quot;é€‰æ‹©è¦æŸ¥æ‰¾çš„ç›®æ ‡å›¾åƒ&quot;;left=146;top=324;right=450;bottom=400;color=14120960;db=1;dl=1;dr=1;font=LOGFONT(h=-14);note=&quot;åœ¨å±å¹•ä¸Šæ¡†é€‰è¦æŸ¥æ‰¾çš„ç›®æ ‡å›¾åƒï¼Œ
ç›®æ ‡å›¾åƒè¶Šå°ï¼Œç‰¹å¾è¶Šæ˜æ˜¾ï¼Œæ‰¾å›¾æ•ˆæœè¶Šå¥½&quot;;z=3};
btnTest={cls=&quot;button&quot;;text=&quot;è¿è¡Œæµ‹è¯•&quot;;left=325;top=7;right=418;bottom=34;dr=1;dt=1;z=5};
editCode={cls=&quot;edit&quot;;left=5;top=40;right=443;bottom=319;db=1;dl=1;dr=1;dt=1;edge=1;hscroll=1;multiline=1;vscroll=1;z=2};
plusImage={cls=&quot;plus&quot;;left=7;top=337;right=106;bottom=385;db=1;dl=1;repeat=&quot;scale&quot;;z=1};
static3={cls=&quot;static&quot;;text=&quot;è‡ªåŠ¨æ‰¾å›¾ä»£ç ï¼š&quot;;left=8;top=14;right=244;bottom=37;dl=1;dt=1;transparent=1;z=4}
)
/*}}*/

import mouse;
import soImage; 
import winex;
winform.btnSnap.oncommand = function(id,event){

    import gdip.snap;
    import mouse.screenArea;
    var screenArea = mouse.screenArea();
    screenArea.onSelectionChanged = function(rc){
        //å°½é‡æˆªå–ç‰¹å¾æ˜æ˜¾çš„å›¾
        var bmp = gdip.snap(screenArea.hwnd,rc);
        var buf = bmp.saveToBuffer(&quot;*.jpg&quot;,80);
        winform.plusImage.background = buf;
        var strJpg = ..string.escape(buf);

        owner.close();  

        var x,y = mouse.getPos();  
        winex.waitClose(screenArea.hwnd); 

        var hwndTarget = winex.fromPointReal( x,y,0x0004/*_CWP_SKIPTRANSPARENT*/ | 0x0001/*_CWP_SKIPINVISIBLE*/  );
        var hwndRoot = win.getRoot(hwndTarget);
        var pClass,pText = winform.validPattern(win.getClass(hwndTarget)) ,winform.validPattern(winex.getText(hwndTarget,50));

        var hwndPattern = string.format(&#39;var hwndParent = winex.find(&quot;%s&quot;,&quot;%s&quot;);&#39;,pClass,pText);
        if( hwndRoot != hwndTarget ){ 
            var pClass2,pText2 = winform.validPattern(win.getClass(hwndRoot)) ,winform.validPattern(winex.getText(hwndRoot,50));
            hwndPattern = string.format(&#39;var hwndParent = winex.find(&quot;%s&quot;,&quot;%s&quot;);\r\nvar hwnd = winex.findEx(hwndParent,,&quot;%s&quot;,&quot;%s&quot;);&#39;,pClass2,pText2,pClass,pText); 
        }

        import string.template;
        var strCode = string.template();
        strCode.template = /***
//åˆ›å»ºè¦æŸ¥æ‰¾çš„ç›®æ ‡å›¾åƒ
import soImage;
var imgFind = soImage();
imgFind.setBytes(&#39;${jpg}&#39;);

//æŸ¥æ‰¾çª—å£
import winex;
${hwnd}

//çª—å£æˆªå›¾
var imgWindow = soImage();
imgWindow.captureWindow(hwnd);

//æŸ¥æ‰¾ç›®æ ‡å›¾åƒ
var sm,x,y = imgFind.findImage( imgWindow );

//ç§»åŠ¨é¼ æ ‡
import mouse; 
mouse.moveToWindow(0,0,hwnd);
mouse.moveToWindow(x,y,hwnd,8);
        ***/

        winform.editCode.text =  strCode.format(
            hwnd = hwndPattern;
            jpg = strJpg; 
        ); 
    }
    screenArea.doModal(); 
}

winform.btnTest.oncommand = function(id,event){
    code = string.trim( winform.editCode.text );
    if(!#code){
        winform.msgboxErr(&quot;è¯·å…ˆé€‰æ‹©ç›®æ ‡å›¾åƒ&quot;);
        return;
    }

    loadcodex(code);
}

winform.validPattern = function(str){
    if(!#str) return &quot;&quot;;

    var mbs = string.match(str,&quot;[\s\w]*:+[\s\w]*&quot;)
    if(#mbs)
        return mbs;

    str = string.replace(str,&quot;(\p)&quot;,&quot;\\\1&quot;)     
    str = string.replace(str,&quot;\x+&quot;,function(str){
        if(..string.find(str,&quot;\d&quot;) ) return &quot;\x+&quot;
        return str;
    } )     

    str = string.replace(str,&quot;\d+&quot;,&quot;\\d+&quot;)  
    return str;
}


winform.show();
win.loopMessage();
</code></pre>
<a href="javascript:if(confirm('https://www.aardio.com/zh-cn/doc/example/Automation/ComputerVision/findImage.md  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª Ëü²»ÔÚÏîÄ¿ÎÄ¼şÀàĞÍ¹æ·¶ÄÚ¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.aardio.com/zh-cn/doc/example/Automation/ComputerVision/findImage.md'" tppabs="https://www.aardio.com/zh-cn/doc/example/Automation/ComputerVision/findImage.md">Markdown æ ¼å¼</a>
</body> 
</html>