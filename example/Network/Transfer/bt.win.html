
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="robots" content="index, follow">
<meta name='description' content='aardio ç¼–ç¨‹è¯­è¨€èŒƒä¾‹ - aria2 ä¸‹è½½ â€”â€” å¦‚æœ BT ä¸‹è½½æ²¡é€Ÿåº¦ï¼Œå…ˆæ‰¾ä¸ªçƒ­é—¨ç§å­ä¸‹è½½å°±å¯ä»¥äº†'>
<meta http-equiv='content-language' content='zh-cn'>
<title>aardio ç¼–ç¨‹è¯­è¨€èŒƒä¾‹ - aria2 ä¸‹è½½ â€”â€” å¦‚æœ BT ä¸‹è½½æ²¡é€Ÿåº¦ï¼Œå…ˆæ‰¾ä¸ªçƒ­é—¨ç§å­ä¸‹è½½å°±å¯ä»¥äº†</title> 
<link rel="stylesheet" href="../../../css/markdown.css" tppabs="https://www.aardio.com/zh-cn/doc/css/markdown.css">
<script src="../../../js/prism.js" tppabs="https://www.aardio.com/zh-cn/doc/js/prism.js"></script>
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css">
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css">
</head>
<body class="markdown-body"><a id="back-to-home" href="../../../index.htm" tppabs="https://www.aardio.com/zh-cn/doc/" title="aardio ç¼–ç¨‹è¯­è¨€æ–‡æ¡£é¦–é¡µ"><i class="fas fa-home" id="home-icon"></i><i class="fas fa-robot" id="ai-icon" style="display: none;"></i><span id="aardio-document-home">aardio æ–‡æ¡£</span></a>
<h1>aardio èŒƒä¾‹: aria2 ä¸‹è½½ â€”â€” å¦‚æœ BT ä¸‹è½½æ²¡é€Ÿåº¦ï¼Œå…ˆæ‰¾ä¸ªçƒ­é—¨ç§å­ä¸‹è½½å°±å¯ä»¥äº†</h1><pre><code class="aardio language-aardio">//BT ä¸‹è½½ / WinForm
import win.ui;
/*DSG{{*/
var winform = win.form(text=&quot;aria2 ä¸‹è½½ â€”â€” å¦‚æœ BT ä¸‹è½½æ²¡é€Ÿåº¦ï¼Œå…ˆæ‰¾ä¸ªçƒ­é—¨ç§å­ä¸‹è½½å°±å¯ä»¥äº†&quot;;right=921;bottom=537;bgcolor=16777215;)
winform.add(
btnAdd={cls=&quot;button&quot;;text=&quot;è°ƒç”¨ aria2 ä¸‹è½½æ–‡ä»¶&quot;;left=605;top=332;right=747;bottom=368;db=1;dr=1;z=3;};
listview={cls=&quot;listview&quot;;left=12;top=7;right=912;bottom=318;bgcolor=16777215;db=1;dl=1;dr=1;dt=1;edge=1;fullRow=1;z=1;};
txtData={cls=&quot;edit&quot;;left=32;top=336;right=585;bottom=367;align=&quot;right&quot;;db=1;dl=1;dr=1;edge=1;z=2;};
txtMessage={cls=&quot;edit&quot;;left=8;top=380;right=909;bottom=523;db=1;dl=1;dr=1;edge=1;hscroll=1;multiline=1;vscroll=1;z=4;};

)
/*}}*/

//å¯åŠ¨ aria2 æœåŠ¡å™¨
import process.aria2;
var aria2 = process.aria2();  

//æ³¨æ„çœ‹é”™è¯¯ä¿¡æ¯ã€‚
aria2.onError = function(errMsg,rpcErr){
    winform.txtMessage.print(errMsg);
}

//å¯åŠ¨ä¸‹è½½æœåŠ¡å™¨
aria2.startServer( maxConcurrentDownloads = 10 );

winform.listview.insertColumn(&quot;æ–‡ä»¶&quot;,250); 
winform.listview.insertColumn(&quot;é€Ÿåº¦&quot;,80);
winform.listview.insertColumn(&quot;å·²ä¸‹è½½&quot;,120); 
winform.listview.insertColumn(&quot;çŠ¶æ€&quot;,-1); 
winform.listview.insertColumn(&quot;è¿æ¥æ•°&quot;,120); 

var aria2Ui = {
    downloadData = {};

    getGid = function(item){
        return table.find(owner.downloadData,item); 
    }

    addTaskInfo = function(gid,url,status){
        if(!gid){
            var name = bencoding.magnet.getName(url);
            winform.listview.addItem({
                name,null,null,&quot;å‡ºé”™äº†ï¼š&quot;+ (status:&quot;æœªçŸ¥é”™è¯¯&quot;);
            });
        } 
        else {
            var taskName = aria2.taskName(gid) 

            var item = owner.downloadData[gid];
            if(!item){ 
                var item = winform.listview.addItem({
                    taskName,null,null,status || &quot;æ­£åœ¨ä¸‹è½½&quot; 
                }); 
                owner.downloadData[gid] =  item;
            }
            else {
                winform.listview.setItemText(taskName,item,1); 
                winform.listview.setItemText(status : &quot;æ­£åœ¨ä¸‹è½½&quot;,item,4); 
            } 
        }
    } 

    updateStatus = function(gid,status){
        var item = owner.downloadData[gid]
        if(!item){
            owner.addTaskInfo(gid);
            item = owner.downloadData[gid]
        }

        winform.listview.setItemText(status,item,4); 
    }

    updateProgress = function(gid,progress){
        var item = owner.downloadData[gid]
        if(!item){
            owner.addTaskInfo(gid);
            item = owner.downloadData[gid]
        }

        if(progress){
            winform.listview.setItemText(progress.connections,item,5); 
            winform.listview.setItemText(math.size64(progress.downloadSpeed,item).format() + &quot;/s&quot;,item,2); 
            winform.listview.setItemText(math.size64(progress.completedLength).format() 
                + &quot;/&quot; + math.size64(progress.totalLength).format(),item,3);     
        }
        else {
            winform.listview.setItemText(&quot;&quot;,item,2); 
            winform.listview.setItemText(&quot;&quot;,item,5); 
            var progress = aria2.tellStatus(gid,&quot;totalLength&quot;);
            winform.listview.setItemText( math.size64(progress.totalLength).format(),item,3);   
        } 
    }  
}

//ç›‘å¬ aria2 äº‹ä»¶
aria2.onDownloadStart = function(task){
    aria2Ui.addTaskInfo(task.gid,,&quot;æ­£åœ¨ä¸‹è½½&quot;)   
}

aria2.onDownloadPause = function(task){ 
    aria2Ui.updateStatus(task.gid,&quot;æš‚åœä¸‹è½½&quot;);  
}

aria2.onDownloadStop = function(task){
    aria2Ui.updateStatus(task.gid,&quot;å·²åœæ­¢&quot;); 
} 

aria2.onDownloadComplete = function(task){
    aria2Ui.updateStatus(task.gid,&quot;å·²å®Œæˆ&quot;);     
    aria2Ui.updateProgress(task.gid);
} 

aria2.onDownloadError = function(task){
    var errMsg = aria2.taskErrorMessage(param.gid); 
    aria2Ui.updateStatus(task.gid,errMsg);  
} 

//è°ƒç”¨ aria2 ä¸‹è½½
winform.btnAdd.oncommand = function(id,event){
    var url = winform.txtData.text;
    if(!#url){
        winform.msgboxErr(&quot;è¯·è¾“å…¥ä¸‹è½½åœ°å€æˆ–ç§å­æ–‡ä»¶è·¯å¾„&quot;)
    }

    aria2.taskAdd(url,function(gid,err){

        if(err){
            aria2Ui.addTaskInfo(null,url,err[[&quot;message&quot;]]); 
        } 
        else {
            aria2Ui.addTaskInfo(gid,url,&quot;æ·»åŠ æˆåŠŸ&quot; ); 
        }    
    });
}
winform.txtData.setCueBannerText(&quot;è¯·è¾“å…¥ä¸‹è½½åœ°å€æˆ–ç§å­æ–‡ä»¶è·¯å¾„&quot;);

//è·å–è¿›åº¦
//https://aria2.github.io/manual/en/html/aria2c.html#aria2.tellStatus 
updateDownloadStatus = function(){

    aria2.tellActive(function(result,err){
        if(result) { 
            for(k,v in result){ 
                aria2Ui.updateProgress(v.gid,v); 
            } 
        }  
    },&quot;gid&quot;,&quot;status&quot;,&quot;connections&quot;,&quot;downloadSpeed&quot;,&quot;totalLength&quot;,&quot;completedLength&quot;); 

    aria2.tellWaiting(0,10,function(result,err){
        if(result) {
            for(k,v in result){
                aria2Ui.updateProgress(v.gid,v); 
            } 
        }  
    },&quot;gid&quot;,&quot;status&quot;,&quot;connections&quot;,&quot;downloadSpeed&quot;,&quot;totalLength&quot;,&quot;completedLength&quot;);  
}

//å¯åŠ¨å°±ç»ªæ‰§è¡Œ
aria2.ready(
    function(){

        //æŸ¥çœ‹é»˜è®¤é…ç½®ã€‚ 
        //winform.txtMessage.print(aria2.getGlobalOption());

        //åˆ›å»ºå®šæ—¶å™¨ï¼Œæ›´æ–°ä¸‹è½½è¿›åº¦
        winform.setInterval(updateDownloadStatus,1500);  
    }
)

//ä¸‹è½½ä»»åŠ¡å³é”®ç®¡ç†èœå•
import win.ui.menu;
winform.listview.onRightClick = function(item,subItem,nmListView){ 

        //åˆ›å»ºå¼¹å‡ºèœå•
        var gid = aria2Ui.getGid(nmListView.iItem);
        if(!gid) return;

        var statusInfo = aria2.tellStatus(gid,&quot;status&quot;,&quot;belongsTo&quot;);
        if(!statusInfo) return;

        var popmenu = win.ui.popmenu(winform); 
        popmenu.add(&#39;ç§»é™¤&#39;,function(id){
            aria2.taskRemove(gid);
            winform.listview.delItem(nmListView.iItem); 
        } ) 

        if(statusInfo.status == &quot;active&quot;){
            popmenu.add(&#39;æš‚åœ&#39;,function(id){ 
                var gid = aria2Ui.getGid(nmListView.iItem);
                aria2.taskPause(gid); 
            } ) 
        }
        if(statusInfo.status == &quot;paused&quot;){
            popmenu.add(&#39;å¼€å§‹ä¸‹è½½&#39;,function(id){ 
                var gid = aria2Ui.getGid(nmListView.iItem);
                aria2.taskUnpause(gid); 
            } ) 
        }

        var path = aria2.taskFilePath(gid)
        if(#path){
            popmenu.add(&#39;æµè§ˆæ–‡ä»¶&#39;,function(id){
                process.exploreSelect(path)
            } ) 
        }

        popmenu.add(&#39;å¤åˆ¶é“¾æ¥&#39;,function(id){
            var url = aria2.taskUrl(gid);
            if(url){
                import win.clip;
                win.clip.write(url);
            }
        } ) 

        popmenu.popup(); 
} 

winform.listview.enableDoubleBuffering();

winform.show(); 
win.loopMessage();
</code></pre>
<a href="javascript:if(confirm('https://www.aardio.com/zh-cn/doc/example/Network/Transfer/bt.win.md  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ·şÎñÆ÷±¨¸æ·ÃÎÊµÄÎÄ¼şÊÇÒş²ØµÄ¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.aardio.com/zh-cn/doc/example/Network/Transfer/bt.win.md'" tppabs="https://www.aardio.com/zh-cn/doc/example/Network/Transfer/bt.win.md">Markdown æ ¼å¼</a>
</body> 
</html>