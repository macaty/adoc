
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="robots" content="index, follow">
<meta name='description' content='aardio ç¼–ç¨‹è¯­è¨€èŒƒä¾‹ - mysql.client åº“ - å…¥é—¨'>
<meta http-equiv='content-language' content='zh-cn'>
<title>aardio ç¼–ç¨‹è¯­è¨€èŒƒä¾‹ - mysql.client åº“ - å…¥é—¨</title> 
<link rel="stylesheet" href="../../../css/markdown.css" tppabs="https://www.aardio.com/zh-cn/doc/css/markdown.css">
<script src="../../../js/prism.js" tppabs="https://www.aardio.com/zh-cn/doc/js/prism.js"></script>
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css">
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css">
</head>
<body class="markdown-body"><a id="back-to-home" href="../../../index.htm" tppabs="https://www.aardio.com/zh-cn/doc/" title="aardio ç¼–ç¨‹è¯­è¨€æ–‡æ¡£é¦–é¡µ"><i class="fas fa-home" id="home-icon"></i><i class="fas fa-robot" id="ai-icon" style="display: none;"></i><span id="aardio-document-home">aardio æ–‡æ¡£</span></a>
<h1>aardio èŒƒä¾‹: mysql.client åº“ - å…¥é—¨</h1><pre><code class="aardio language-aardio">//mysql.client åº“ - å…¥é—¨
import console;
import mysql.client;

/*
MySQL å¿«é€Ÿå…¥é—¨
https://learnxinyminutes.com/docs/zh-cn/sql-cn/
https://quickref.me/mysql
*/
console.showLoading(&quot; æ­£åœ¨è¿æ¥æµ‹è¯•æ•°æ®åº“&quot; )
var dbClient,err = mysql.client(
    server = &quot;db4free.net&quot;; //æœåŠ¡å™¨ï¼Œæ ¼å¼ä¸º&quot;åŸŸåæˆ–IP:ç«¯å£å·&quot;æˆ–&quot;åŸŸåæˆ–IP&quot;ï¼Œçœç•¥åˆ™é»˜è®¤ä¸º &quot;localhost&quot;ã€‚
    uid = &quot;aardio_mysql&quot;;//ç”¨æˆ·åï¼Œçœç•¥åˆ™é»˜è®¤ä¸º&quot;root&quot;ã€‚
    pwd = &quot;aardio.com&quot;;//å¯†ç ã€‚
    database = &quot;aardio_mysql&quot;; //å¯é€‰æŒ‡å®šæ•°æ®åº“
); 

if(!dbClient){ 
    console.log(&quot;å¦‚æœæ˜¯æœ‰äººæ— èŠä¿®æ”¹äº†å¯†ç ,è¯·è‡ªè¡Œåˆ° db4free.net ç”³è¯·å…è´¹æ•°æ®åº“&quot;)
    return console.logPause(err); 
}

//é€‰æ‹©æ•°æ®åº“
//dbClient.selectDb(&quot;aardio_mysql&quot;)  

//æŸ¥è¯¢æ•°æ®å¹¶è¿”å›è®°å½•é›†
var result = dbClient.stepQuery(&quot;select version()&quot;);
console.dump(result)

/*
dbClient.query(sql,...) ç­‰æ‰€æœ‰éœ€è¦æ ¼å¼åŒ–SQLè¯­å¥çš„å‡½æ•°ï¼Œ
å†…éƒ¨éƒ½æ˜¯è°ƒç”¨ dbClient.format(sql,...) å‡½æ•°è½¬æ¢ SQL è¯­å¥ã€‚

å¦‚æœSQLå‚æ•°åé¢çš„æ ¼å¼åŒ–å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒSQLä¸­çš„å ä½ç¬¦è¯·ä½¿ç”¨?æˆ–??ï¼Œ
å¦‚æœæ ¼å¼åŒ–å‚æ•°æ˜¯éæ•°ç»„çš„è¡¨å‚æ•°ï¼ŒSQLä¸­çš„å ä½ç¬¦è¯·ä½¿ç”¨@å¼€å¤´çš„å‘½åå‚æ•°ã€‚
å¦‚æœæ ¼å¼åŒ–å‚æ•°ä¸æ˜¯è¡¨ï¼Œåˆ™è°ƒç”¨  string.format(sql,...) æ ¼å¼åŒ–ã€‚

dbClient.format()å¯¹äºæ•°å€¼å’Œå¸ƒå°”å€¼ä¸ä½œè½¬æ¢ï¼Œ
å­—ç¬¦ä¸²ä¼šè¿›è¡Œå®‰å…¨è½¬ä¹‰å¤„ç†ï¼ˆå¯é¿å…SQLéæ³•æ³¨å…¥ï¼‰ï¼Œbufferä¼šè½¬æ¢ä¸º16è¿›åˆ¶ç¼–ç ã€‚
å¦‚æœå‚æ•°å€¼æ˜¯æ•°ç»„åˆ™å±•å¼€ä¸ºåˆ—è¡¨,ä¾‹å¦‚ &#39;a&#39;,&#39;b&#39;ï¼Œ
å¦‚æœæ˜¯åµŒå¥—æ•°ç»„åˆ™å±•å¼€ä¸ºåˆ†ç»„åˆ—è¡¨, ä¾‹å¦‚(&#39;a&#39;,&#39;b&#39;),(&#39;c&#39;,&#39;d&#39;)
å¦‚æœå‚æ•°å€¼æ˜¯å‘½åè¡¨å¯¹è±¡ï¼ˆéæ•°ç»„ï¼‰ï¼Œåˆ™æ ¼å¼åŒ–ä¸ºSQLé”®å€¼å¯¹ï¼ˆé”®è°ƒç”¨dbMysql.escapeId å‡½æ•°æ ¼å¼åŒ– ï¼‰ã€‚
*/

//ä¸ºé¿å…æœ‰äººä¹±æ”¹æµ‹è¯•æ•°æ®åº“è¡¨ç»“æ„åˆæ²¡æœ‰åˆ é™¤ï¼Œå…ˆåˆ é™¤æ—§çš„è¡¨
dbClient.query(&quot;DROP TABLE IF EXISTS ??&quot;,{library});
//ä¸Šé¢çš„SQLä¼šæ ¼å¼åŒ–ä¸º &quot;DROP TABLE IF EXISTS `library`&quot;

//æ‰§è¡ŒSQLè¯­å¥,æ³¨æ„mysqlè¡¨åã€å­—æ®µåå¯åŒ…å«äºåå¼•å·å†…(ç”¨é”®ç›˜å·¦ä¸Šè§’ESCä¸‹æ–¹çš„æŒ‰é”®å†…)
var ret,err = dbClient.query(&quot;CREATE TABLE IF NOT EXISTS `library` (
    `id` int NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(100) NOT NULL, 
    `auditing` TINYINT(1) DEFAULT &#39;0&#39;,
    `bytes` BLOB,
    `time` DATETIME DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    UNIQUE KEY `id` (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;&quot;);
console.dump(ret,err)

var dbTable,err  = dbClient.listTables() 
for tbl in dbTable.each(){
    console.log(&quot;å‘ç°æ•°æ®è¡¨:&quot;,tbl);
}

var ret,err = dbClient.query(&quot;INSERT `library` VALUES(null,&#39;æµ‹è¯•&#39;,@num,@str,@time)&quot;,{
    num = 123;
    str = raw.buffer(&quot;æµ‹è¯•:&#39;è¿™æ˜¯å­—ç¬¦ä¸²!&#39;å‘½åå‚æ•°å¯ä»¥è‡ªåŠ¨å¤„ç†å­—ç¬¦ä¸²è½¬ä¹‰&quot;);
    time = time();
} ) 

console.dump(ret)

//å¦‚æœæ˜¯å ä½ç¬¦å¯¹åº”çš„æ ¼å¼åŒ–å‚æ•°æ˜¯åµŒå¥—æ•°ç»„åˆ™å±•å¼€ä¸ºåˆ†ç»„åˆ—è¡¨, ä¾‹å¦‚(&#39;a&#39;,&#39;b&#39;),(&#39;c&#39;,&#39;d&#39;)
var ret,err = dbClient.query(&quot;INSERT `library`(`name`,`auditing`,`bytes`,`time`) VALUES ?&quot;,{ {
    {&#39;åµŒå¥—æ•°ç»„1&#39;,123,&quot;æµ‹è¯•xx&quot;,time()}
    {&#39;åµŒå¥—æ•°ç»„2&#39;,123,raw.buffer(&quot;æµ‹è¯•xxx2&quot;),time()}
} } ) 
console.dump(ret,err);

var ret,err = dbClient.query(&quot;INSERT `library`(`name`,`auditing`,`bytes`,`time`) VALUES(&#39;æµ‹è¯•2&#39;,@num,@str,@time)&quot;,{
    num = 123;
    str = &quot;æµ‹è¯•2&quot;;
    time = time().addday(-2);
} ) 
console.dump(ret,err);

//å¦‚æœæ ¼å¼åŒ–å‚æ•°å€¼æ˜¯æ•°ç»„åˆ™å±•å¼€ä¸ºåˆ—è¡¨,ä¾‹å¦‚ &#39;a&#39;,&#39;b&#39;ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š
dbClient.query(&quot;DELETE FROM `library` WHERE `name` IN (?)&quot;,{{&#39;åµŒå¥—æ•°ç»„1&#39;,&#39;åµŒå¥—æ•°ç»„2&#39;}})

//æŸ¥è¯¢æ•°æ®å¹¶è¿”å›è®°å½•é›†
var result = dbClient.query(&quot;SELECT * FROM `library` WHERE time &gt;=@time&quot;,{
    time = tostring(time().addday(-3),&quot;%Y/%m/%d&quot;)
});
for name,auditing,bytes in result.each(){ 
    console.log(&quot;è¾“å‡º&quot;, name,auditing,bytes ); //é€è¡Œè¾“å‡ºæ‰€æœ‰è®°å½•
}

//æŸ¥è¯¢æ•°æ®å¹¶è¿”å›å…¨éƒ¨è®°å½•é›†åˆ°ä¸€ä¸ªè¡¨
var result = dbClient.query(&quot;SELECT * FROM `library` WHERE time &gt;= (
    SELECT DATE(`time`) FROM `library` ORDER BY `time` DESC LIMIT 0,1
)&quot;);
console.dumpJson(result.getTable())

//åˆ›å»ºå­˜å‚¨è¿‡ç¨‹
var ret,err = dbClient.query(&quot;
CREATE PROCEDURE demo(IN n int)  
BEGIN     
    SET n=123;   
    SELECT n;  
END;   
&quot;)

//è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
var ret,err = dbClient.getTable(&quot;CALL demo(@n)&quot;,{
    n=123 //ä¼ å…¥å‘½åå‚æ•°
});

console.dump(ret);

//ç§»é™¤å­˜å‚¨è¿‡ç¨‹
console.dump( dbClient.query(&quot;DROP PROCEDURE IF EXISTS `demo`&quot;) );

//ç§»é™¤æ•°æ®åº“
dbClient.query(&quot;DROP TABLE IF EXISTS `library`&quot;);
console.pause();
</code></pre>
<a href="javascript:if(confirm('https://www.aardio.com/zh-cn/doc/example/Database/mysql/mysql.md  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª Ëü²»ÔÚÏîÄ¿ÎÄ¼şÀàĞÍ¹æ·¶ÄÚ¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.aardio.com/zh-cn/doc/example/Database/mysql/mysql.md'" tppabs="https://www.aardio.com/zh-cn/doc/example/Database/mysql/mysql.md">Markdown æ ¼å¼</a>
</body> 
</html>