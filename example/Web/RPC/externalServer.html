
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="robots" content="index, follow">
<meta name='description' content='aardio ç¼–ç¨‹è¯­è¨€èŒƒä¾‹ - RPC æœåŠ¡ç«¯ - æ”¯æŒä»»æ„æœ¬åœ°ç½‘é¡µè°ƒç”¨ aardio å‡½æ•°'>
<meta http-equiv='content-language' content='zh-cn'>
<title>aardio ç¼–ç¨‹è¯­è¨€èŒƒä¾‹ - RPC æœåŠ¡ç«¯ - æ”¯æŒä»»æ„æœ¬åœ°ç½‘é¡µè°ƒç”¨ aardio å‡½æ•°</title> 
<link rel="stylesheet" href="../../../css/markdown.css" tppabs="https://www.aardio.com/zh-cn/doc/css/markdown.css">
<script src="../../../js/prism.js" tppabs="https://www.aardio.com/zh-cn/doc/js/prism.js"></script>
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css">
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css">
</head>
<body class="markdown-body"><a id="back-to-home" href="../../../index.htm" tppabs="https://www.aardio.com/zh-cn/doc/" title="aardio ç¼–ç¨‹è¯­è¨€æ–‡æ¡£é¦–é¡µ"><i class="fas fa-home" id="home-icon"></i><i class="fas fa-robot" id="ai-icon" style="display: none;"></i><span id="aardio-document-home">aardio æ–‡æ¡£</span></a>
<h1>aardio èŒƒä¾‹: RPC æœåŠ¡ç«¯ - æ”¯æŒä»»æ„æœ¬åœ°ç½‘é¡µè°ƒç”¨ aardio å‡½æ•°</h1><pre><code class="aardio language-aardio">//external æœåŠ¡å™¨
import win.ui;
/*DSG{{*/
var winform = win.form(text=&quot;RPC æœåŠ¡ç«¯ - æ”¯æŒä»»æ„æœ¬åœ°ç½‘é¡µè°ƒç”¨ aardio å‡½æ•°&quot;;right=759;bottom=469)
winform.add(
edit={cls=&quot;richedit&quot;;left=23;top=24;right=730;bottom=446;edge=1;hscroll=1;multiline=1;vscroll=1;z=1}
)
/*}}*/

import web.rpc.externalServer;
var externalServer = web.rpc.externalServer();

//åªæœ‰ä¸‹é¢æŒ‡å®šçš„å‡½æ•°ç½‘é¡µæ‰èƒ½è°ƒç”¨
externalServer.external = {
    test = function(...){
        winform.edit.print(&quot;external.test è¢«è°ƒç”¨&quot;,...)
    }
    tag = function(strs,...){
        var args = {...}
        for(i=#args;1;-1){
            table.insert(strs,args[i],i+1);
        }

        strs = string.join(strs);
        return strs;
    }
}

//å¯é€‰ç”¨ä¸‹é¢çš„æ–¹æ³•é™å®šåªæœ‰ä¸‹é¢å…è®¸çš„å¤–éƒ¨åŸŸåæ‰èƒ½è®¿é—® aardio å‡½æ•°
externalServer.accessControlAllowOrigin = {
    [&quot;https://d.aardio.com&quot;] = true //æŒ‡å®šå‡†ç¡®å‰ç¼€ï¼ŒåŸŸååä¸è¦åŠ æ–œæ†
}

//å¦‚æœä¸æŒ‡å®šç«¯å£å·ï¼Œåˆ™é»˜è®¤åŠ¨æ€åˆ†é…ç©ºé—²çš„ç«¯å£å·
//å¦‚æœä¸æŒ‡å®šå…·ä½“çš„ç«¯å£å·ï¼Œåˆ™åªæœ‰ externalServer æä¾›çš„ç½‘é¡µæ‰èƒ½è‡ª aardio.js è‡ªåŠ¨è·å–åˆ°ç«¯å£å·
winform.edit.print( &quot;å¯åŠ¨æœåŠ¡å™¨ï¼š&quot;,externalServer.start())
winform.edit.print( &quot;è¯·åœ¨ç½‘é¡µä¸­å¼•å…¥ï¼š&quot;,externalServer.getUrl(&quot;aardio.js&quot;))

externalServer.httpHandler[&quot;/test.html&quot;] = function(response,request){
    var html = /**
    &lt;!doctype html&gt;
    &lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot;&gt;
        &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; /&gt;
        &lt;script src=&quot;&lt;?=owner.rpcUrl?&gt;&quot;&gt;&lt;/script&gt;
        &lt;script&gt;
        /*
        ä¹Ÿå¯ä»¥åœ¨å‰ç«¯æºç ä¸­ç”¨ npm i aardio å®‰è£… aardio.js ã€‚
        externalServer æä¾›çš„ aardio.js è‡ªåŠ¨è·å– RPC ç«¯å£å¹¶åˆå§‹åŒ– RPC æ–¹æ³•ã€‚
        å¦‚æœåœ¨åˆ›å»º web.rpc.externalServer ä»¥åè°ƒç”¨æ ‡å‡†åº“ä¸­çš„ nodeJs åˆ›å»º Node.js  è¿›ç¨‹ï¼Œ
        ä¹Ÿå¯ä»¥è‡ªåŠ¨è·å–ç«¯å£å·å¹¶åœ¨è¿æ¥æˆåŠŸå‰åˆ›å»ºè¿œç¨‹å‡½æ•°ã€‚

        è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ç½‘é¡µå¯é€šè¿‡ URL å‚æ•°è·å– RPC ç«¯å£å¹¶åˆå§‹åŒ– RPC æ–¹æ³•ã€‚
        ä¹Ÿå¯ä»¥è°ƒç”¨ aardio.open( ç«¯å£å· ) è¿æ¥æŒ‡å®šçš„ç«¯å£ã€‚
        å¯å‚è€ƒï¼šhttps://d.aardio.com/ajs/demo.html
        */

        //è°ƒç”¨ aardio å‡½æ•°ã€‚
        aardio.test(&quot;è¿™æ˜¯ç½‘é¡µè°ƒç”¨ aardio çš„å‚æ•°&quot;,1122);

        //ç”¨ aardio è§£ææ¨¡æ¿å­—ç¬¦ä¸²
        let $ = aardio.tag;
        $`abc${123}ddd${456}`.then( v=&gt; alert(&quot;æ¨¡æ¿å­—ç¬¦ä¸²:&quot;+v)  )

        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;&lt;?=owner.rpcUrl?&gt;&lt;/body&gt;&lt;/html&gt;
    **/
    response.write( string.loadcode(html,{rpcUrl=externalServer.getUrl(&quot;aardio.js&quot;)}) );    
}

import process;
process.openUrl(externalServer.getUrl(&quot;/test.html&quot;))

/*
å¦‚æœä¼ å…¥å°å†™ http: æˆ– https: å¼€å¤´çš„ç½‘å€ï¼Œ
åˆ™è¿”å›äº†é™„åŠ  rpcServerPort ä¸ rpcAasdl å‚æ•°çš„ç½‘å€ï¼Œ
aardio.js è¯†åˆ«è¿™äº›å‚æ•°åè‡ªåŠ¨è·å– RPC ç«¯å£å¹¶åˆå§‹åŒ– RPC æ–¹æ³•ã€‚

æœªä¼ ä»¥ä¸Šå‚æ•°åˆ™ç½‘é¡µä¸­å¿…é¡»è°ƒç”¨ aardio.open è¿æ¥æŒ‡å®šçš„ç«¯å£ã€‚ 
*/
var rpcUrl = externalServer.getUrl(&quot;https://d.aardio.com/ajs/demo.html&quot;);
process.openUrl( rpcUrl );

//ä¸Šé¢ demo.html çš„æºç å¦‚ä¸‹ï¼š
/**
&lt;!doctype html&gt;
&lt;html&gt;&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;script src=&quot;https://d.aardio.com/ajs/aardio.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
        (async () =&gt; {
            /*
            aardio.js å¯è‡ªåŠ¨ä»ç½‘å€å‚æ•° rpcServerPortï¼ŒrpcAasdl è·å–å¹¶è¿æ¥ç«¯å£ä¸æ‰€æœ‰è¿œç¨‹å‡½æ•°ã€‚ 
            å¦‚æœæœªæŒ‡å®šå‚æ•°ï¼Œåˆ™åº”è°ƒç”¨ aardio.open( RPCç«¯å£å· ) æ‰“å¼€ RPC æœåŠ¡å™¨ã€‚ 
            aardio.open è¿”å› Promise å¯¹è±¡ã€‚ 

            è¿æ¥æˆåŠŸå‰åªèƒ½ä½¿ç”¨ aardio.xcall è°ƒç”¨æœ¬åœ°å‡½æ•°ã€‚ 
            */
            //await aardio.open(8082);

            await aardio.test(&quot;è¿™æ˜¯ç½‘é¡µè°ƒç”¨ aardio çš„å‚æ•°&quot;, 1122);

            let $ = aardio.tag;
            $`abc${123}ddd${456}`.then(v =&gt; alert(&quot;æ¨¡æ¿å­—ç¬¦ä¸²:&quot; + v));
        })()
    &lt;/script&gt;
&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;
**/

winform.show();
win.loopMessage();
</code></pre>
<a href="javascript:if(confirm('https://www.aardio.com/zh-cn/doc/example/Web/RPC/externalServer.md  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª Ëü²»ÔÚÏîÄ¿ÎÄ¼şÀàĞÍ¹æ·¶ÄÚ¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.aardio.com/zh-cn/doc/example/Web/RPC/externalServer.md'" tppabs="https://www.aardio.com/zh-cn/doc/example/Web/RPC/externalServer.md">Markdown æ ¼å¼</a>
</body> 
</html>