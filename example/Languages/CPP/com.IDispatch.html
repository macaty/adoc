
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="robots" content="index, follow">
<meta name='description' content='aardio ç¼–ç¨‹è¯­è¨€èŒƒä¾‹ - COM æ¥å£'>
<meta http-equiv='content-language' content='zh-cn'>
<title>aardio ç¼–ç¨‹è¯­è¨€èŒƒä¾‹ - COM æ¥å£</title> 
<link rel="stylesheet" href="../../../css/markdown.css" tppabs="https://www.aardio.com/zh-cn/doc/css/markdown.css">
<script src="../../../js/prism.js" tppabs="https://www.aardio.com/zh-cn/doc/js/prism.js"></script>
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css">
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css">
</head>
<body class="markdown-body"><a id="back-to-home" href="../../../index.htm" tppabs="https://www.aardio.com/zh-cn/doc/" title="aardio ç¼–ç¨‹è¯­è¨€æ–‡æ¡£é¦–é¡µ"><i class="fas fa-home" id="home-icon"></i><i class="fas fa-robot" id="ai-icon" style="display: none;"></i><span id="aardio-document-home">aardio æ–‡æ¡£</span></a>
<h1>aardio èŒƒä¾‹: COM æ¥å£</h1><pre><code class="aardio language-aardio">//COM æ¥å£
import vc6; 
var vc = vc6( &quot;/&quot; )  

//è¾“å…¥ C++ æºç ï¼Œè‡ªåŠ¨å­˜ä¸º /comMain.cpp
vc.comMain  = /****** 
#include &lt;afxwin.h&gt; 
#include &lt;afxdisp.h&gt;

class CTestObject: public CCmdTarget
{ 
    DECLARE_DYNCREATE(CTestObject)
    CTestObject(); 
protected:
    virtual ~CTestObject();
    CString strName;
public:
    afx_msg BSTR GetName();
    afx_msg void SetName(LPCTSTR lpszName); 
    DECLARE_DISPATCH_MAP()
};

IMPLEMENT_DYNCREATE(CTestObject, CCmdTarget)
CTestObject::CTestObject() {
    EnableAutomation();
    AfxOleLockApp(); 
}
CTestObject::~CTestObject() {
    AfxOleUnlockApp();
}

BEGIN_DISPATCH_MAP(CTestObject, CCmdTarget) 
    DISP_PROPERTY_EX(CTestObject, &quot;name&quot;, GetName, SetName, VT_BSTR) 
END_DISPATCH_MAP()

BSTR CTestObject::GetName() 
{ 
     return strName.AllocSysString();
}

void  CTestObject::SetName(LPCTSTR lpszName) 
{ 
    strName = lpszName;
} 

extern &quot;C&quot; __declspec(dllexport) LPDISPATCH __cdecl CreateIDispatchObject() {
   LPDISPATCH pDispatch = ( new CTestObject() )-&gt;GetIDispatch(FALSE);//å‚æ•°FALSEæŒ‡å®šä¸è¦æ·»åŠ å¼•ç”¨è®¡æ•°
   return pDispatch;
}
******/ 

//ç¼–è¯‘ç”ŸæˆDLL 
vc.exec(
    &#39;cl comMain.cpp&#39;
    ,&#39;/W3&#39; /*è­¦å‘Šç­‰çº§*/
    ,&#39;/MD&#39; /*ä½¿ç”¨å¤šçº¿ç¨‹åŠ¨æ€è¿è¡Œåº“*/
    ,&#39;/O2 /Ot /EHsc&#39; /*ä»£ç ä¼˜åŒ–é€‰é¡¹*/
    ,&#39;/D &quot;WIN32&quot; /D &quot;_WINDOWS&quot; /D &quot;_MBCS&quot; /D &quot;_USRDLL&quot; /D &quot;_AFXDLL&quot; &#39; /*å®šä¹‰å¸¸æ•°å’Œå®*/
    ,&#39;/I&quot;./INCLUDE&quot;&#39;/*æŒ‡å®šå¤´æ–‡ä»¶ç›®å½•*/
    ,&#39;kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib&#39; /*å¯¼å…¥åº“*/
    ,&#39;/link /SUBSYSTEM:WINDOWS /MACHINE:X86&#39; /*åé¢æ˜¯é“¾æ¥å‚æ•° */
    ,&#39;/out:test.disp.dll&#39;/*è¾“å‡ºæ–‡ä»¶å*/
    ,&#39;/dll&#39; /*è¾“å‡ºDLL*/ 
    ,&#39;/LIBPATH:&quot;.\LIB&quot; /LIBPATH:&quot;.\LIB2&quot;&#39; /*æŒ‡å®šåº“ç›®å½•*/
)

//åŠ è½½ DLL
var dll = raw.loadDll(&quot;/test.disp.dll&quot;,,&quot;cdecl&quot;);

//åˆ›å»º COM å¯¹è±¡ï¼Œaardio å¯è‡ªåŠ¨æ”¯æŒ IDispatch æ¥å£
//https://www.aardio.com/zh-cn/doc/library-guide/builtin/com/com.html
import com;
var comObject = com.QueryObjectR( dll.CreateIDispatchObjectP() );

//ä½¿ç”¨ COM å¯¹è±¡
comObject.name = &quot;æµ‹è¯•&quot;;
console.log( comObject.name ); 
console.pause();
</code></pre>
<a href="javascript:if(confirm('https://www.aardio.com/zh-cn/doc/example/Languages/CPP/com.IDispatch.md  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª Ëü²»ÔÚÏîÄ¿ÎÄ¼şÀàĞÍ¹æ·¶ÄÚ¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.aardio.com/zh-cn/doc/example/Languages/CPP/com.IDispatch.md'" tppabs="https://www.aardio.com/zh-cn/doc/example/Languages/CPP/com.IDispatch.md">Markdown æ ¼å¼</a>
</body> 
</html>