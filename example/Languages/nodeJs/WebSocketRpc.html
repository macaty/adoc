
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="robots" content="index, follow">
<meta name='description' content='aardio ç¼–ç¨‹è¯­è¨€èŒƒä¾‹ - aardioåˆ›å»ºWebSocket/JSON-RPC æœåŠ¡ç«¯ä¸Node.jsäº¤äº’çš„ä¾‹å­'>
<meta http-equiv='content-language' content='zh-cn'>
<title>aardio ç¼–ç¨‹è¯­è¨€èŒƒä¾‹ - aardioåˆ›å»ºWebSocket/JSON-RPC æœåŠ¡ç«¯ä¸Node.jsäº¤äº’çš„ä¾‹å­</title> 
<link rel="stylesheet" href="../../../css/markdown.css" tppabs="https://www.aardio.com/zh-cn/doc/css/markdown.css">
<script src="../../../js/prism.js" tppabs="https://www.aardio.com/zh-cn/doc/js/prism.js"></script>
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css">
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css">
</head>
<body class="markdown-body"><a id="back-to-home" href="../../../index.htm" tppabs="https://www.aardio.com/zh-cn/doc/" title="aardio ç¼–ç¨‹è¯­è¨€æ–‡æ¡£é¦–é¡µ"><i class="fas fa-home" id="home-icon"></i><i class="fas fa-robot" id="ai-icon" style="display: none;"></i><span id="aardio-document-home">aardio æ–‡æ¡£</span></a>
<h1>aardio èŒƒä¾‹: åˆ›å»ºWebSocket/JSON-RPC æœåŠ¡ç«¯ä¸Node.jsäº¤äº’çš„ä¾‹å­</h1><pre><code class="aardio language-aardio">//Node.js é€šè¿‡ JSON-RPC(WebSocket) è°ƒç”¨ aardio
import win.ui;
/*DSG{{*/
var winform = win.form(text=&quot;aardioåˆ›å»ºWebSocket/JSON-RPC æœåŠ¡ç«¯ä¸Node.jsäº¤äº’çš„ä¾‹å­&quot;;left=10;top=4;right=774;bottom=467)
winform.add(
txtMessage={cls=&quot;edit&quot;;left=29;top=22;right=741;bottom=432;db=1;dl=1;dr=1;dt=1;edge=1;multiline=1;z=1}
)
/*}}*/

//åˆ›å»º WebSocket æœåŠ¡ç«¯
import web.socket.server;
var wsrv = web.socket.server();

//åˆ›å»º JSON-RPC æœåŠ¡ç«¯
import web.socket.jsonServer;
var rpcServer = web.socket.jsonServer(wsrv);

//è¿™é‡Œå¯ä»¥è‡ªå®šä¹‰WebSocket æœåŠ¡ç«¯å¯ä»¥ä½¿ç”¨çš„ URL è·¯å¾„
wsrv.onUpgradeToWebsocket = function(hSocket,request,response,protocol,origin){    
    return rpcServer.start(hSocket);
}

//æŒ‡å®š node.js å®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨çš„å¯¹è±¡å’Œæ–¹æ³•
rpcServer.external = {

    hello = function(a,b){
        winform.txtMessage.print(&quot;node.jsè°ƒç”¨helloå‡½æ•°,å‚æ•°ï¼š&quot;,a,b);
        return &quot;æ¥è‡ªaardioçš„è¿”å›å€¼ &quot; ;
    }

    aardio  = {

        print = function(txt){
            winform.txtMessage.print( txt );
        }
    }
} 

//å¯åŠ¨ WebSocket æœåŠ¡ç«¯
wsrv.start();

import nodeJs;
nodeJs.startEnviron(
    wsUrl = wsrv.getUrl();//è®¾ç½®node.jsçš„å¯åŠ¨å‚æ•°
)

var js = /*** 
var startEnviron = require(&#39;startEnviron&#39;);
var WebSocket = require(&#39;rpc-websockets&#39;).Client;

var ws = new WebSocket(startEnviron.wsUrl)
ws.on(&#39;open&#39;, function() {

  ws.call(&#39;hello&#39;, [&#39;JSä¼ è¿‡æ¥çš„å‚æ•°1&#39;, &#39;JSä¼ è¿‡æ¥çš„å‚æ•°2&#39;]).then(result=&gt; {

    //ä¹Ÿå¯ä»¥æ”¯æŒåå­—ç©ºé—´ï¼Œæ³¨æ„è°ƒç”¨å‚æ•°å¿…é¡»æ”¾åˆ°æ•°ç»„é‡Œ
    ws.call(&quot;aardio.print&quot;,[result]).catch(e=&gt;{
        console.log(&quot;bm &quot;,e)
    });
  })
})
***/

//è‡ªåŠ¨å®‰è£… JS ä»£ç ä¸­å¼•ç”¨çš„æ¨¡å—ï¼Œå¦‚æœå·²ç»å®‰è£…äº†æ¨¡å—ï¼Œè¿™å¥ä»£ç ä¼šè‡ªåŠ¨å¿½ç•¥ä¸æ‰§è¡Œ
nodeJs.prequireByJs(winform.txtMessage,js);

//æ‰§è¡ŒJSä»£ç ï¼ŒnodeJs.execLimit å‡½æ•°ä¼šä¿è¯åœ¨é€€å‡ºæ—¶é€€å‡º Node è¿›ç¨‹
var node = nodeJs.execLimit(js); 

//å°† Node è¿›ç¨‹æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–‡æœ¬æ¡†ä¸­
node.logResponse(winform.txtMessage);

winform.show(); 
win.loopMessage();
</code></pre>
<a href="javascript:if(confirm('https://www.aardio.com/zh-cn/doc/example/Languages/nodeJs/WebSocketRpc.md  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª Ëü²»ÔÚÏîÄ¿ÎÄ¼şÀàĞÍ¹æ·¶ÄÚ¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.aardio.com/zh-cn/doc/example/Languages/nodeJs/WebSocketRpc.md'" tppabs="https://www.aardio.com/zh-cn/doc/example/Languages/nodeJs/WebSocketRpc.md">Markdown æ ¼å¼</a>
</body> 
</html>