
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="robots" content="index, follow">
<meta name='description' content='aardio ç¼–ç¨‹è¯­è¨€èŒƒä¾‹ - ç¼–è¯‘ DLL'>
<meta http-equiv='content-language' content='zh-cn'>
<title>aardio ç¼–ç¨‹è¯­è¨€èŒƒä¾‹ - ç¼–è¯‘ DLL</title> 
<link rel="stylesheet" href="../../../css/markdown.css" tppabs="https://www.aardio.com/zh-cn/doc/css/markdown.css">
<script src="../../../js/prism.js" tppabs="https://www.aardio.com/zh-cn/doc/js/prism.js"></script>
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css">
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css">
</head>
<body class="markdown-body"><a id="back-to-home" href="../../../index.htm" tppabs="https://www.aardio.com/zh-cn/doc/" title="aardio ç¼–ç¨‹è¯­è¨€æ–‡æ¡£é¦–é¡µ"><i class="fas fa-home" id="home-icon"></i><i class="fas fa-robot" id="ai-icon" style="display: none;"></i><span id="aardio-document-home">aardio æ–‡æ¡£</span></a>
<h1>aardio èŒƒä¾‹: ç¼–è¯‘ DLL</h1><pre><code class="aardio language-aardio">//ç¼–è¯‘ DLL
import process.gfortran;

//åˆ›å»º gfortran ç¼–è¯‘ç¯å¢ƒï¼Œå‚æ•°æŒ‡å®šå·¥ä½œç›®å½•ï¼Œå•ä¸ªæ–œæ æˆ–åæ–œæ†è¡¨ç¤ºåº”ç”¨ç¨‹åºæ ¹ç›®å½•ï¼ˆå·¥ç¨‹ç›®å½•ã€æˆ–å·¥ç¨‹å¤–ç‹¬ç«‹å¯åŠ¨æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œå‘å¸ƒåä¸º EXE ç›®å½•ï¼‰
var fortran = process.gfortran(&quot;/&quot;);

/*
åœ¨å·¥ä½œç›®å½•ä¸‹ä¿å­˜ä¸ºåŒåæºç æ–‡ä»¶ï¼Œ
ä¹Ÿå¯ä»¥å†™ä¸º fortran[&quot;main.f95&quot;] æ˜¾å¼æŒ‡å®šåç¼€åï¼ˆå¯ä½¿ç”¨ f90,f95,f03 ç­‰åç¼€åï¼‰ã€‚

Fortran å¿½ç•¥å¤§å°å†™
Fortran å‚æ•°é»˜è®¤æ˜¯ä¼ å€çš„ï¼ˆä¼ æŒ‡é’ˆï¼‰
Fortran å¿«é€Ÿå…¥é—¨: https://learnxinyminutes.com/docs/zh-cn/fortran95-cn/
*/
fortran.main = /* 
module test
!å¼•å…¥æ”¯æŒCè¯­è¨€ç±»å‹çš„æ¨¡å—ï¼Œä¸èƒ½å†™åœ¨ DLLEXPORT åé¢  https://gcc.gnu.org/onlinedocs/gfortran/ISO_005fC_005fBINDING.html
use iso_c_binding  !Fortran 2003 ç‰¹æ€§

type, bind(c) :: POINT
  integer(c_int) :: x
  integer(c_int) :: y
end type POINT

CONTAINS 

integer function Add (a,b)  
    !å£°æ˜ä¸º DLL å¯¼å‡ºå‡½æ•°ï¼Œå…³é”®æ˜¯ä¸‹é¢è¿™å¥ï¼Œè°ƒç”¨çº¦å®šå»ºè®®ç”¨ CDECLï¼Œæœ€åé¢çš„å‡½æ•°åè¦ä¸€è‡´
    !GCC$ ATTRIBUTES CDECL,DLLEXPORT ::Add 

    !Fortran é»˜è®¤æ˜¯ä¼ å€çš„ï¼Œæ‰€ä»¥ integer å®é™…ä¸Šæ˜¯ç›¸å½“äºCè¯­è¨€çš„ int æŒ‡é’ˆã€‚
    integer  :: a   
    integer :: b 
    Add = a + b
END  function 

integer(c_int) function AddByVal(i,j,d) 
    !GCC$ ATTRIBUTES CDECL,DLLEXPORT ::AddByVal  !å£°æ˜ä¸º DLL å¯¼å‡ºå‡½æ•° 

    !å£°æ˜ä¸º Cè¯­è¨€ int ç±»å‹ï¼ŒVALUE çš„æ„æ€æ˜¯ä¼ å€¼
    integer(c_int), VALUE :: i
    integer(c_int), VALUE :: j 
    real(c_double), VALUE :: d
    AddByVal = i + j 
end  function

integer(c_int) function AddByPoint(pt) 
    !GCC$ ATTRIBUTES CDECL,DLLEXPORT ::AddByPoint    
    type(POINT) :: pt  

    ! Fortran é‡Œç”¨ % å·è®¿é—®æˆå‘˜ï¼ˆç±»ä¼¼ aardio é‡Œçš„ . ç¬¦å·ï¼‰
    AddByPoint = pt%x + pt%y 
end  function

integer(c_int) function hello(str,len) 
    !GCC$ ATTRIBUTES CDECL,DLLEXPORT ::hello    
    CHARACTER*(*) :: str
    integer(c_int), VALUE ::  len

    !é‡æ–°ç»‘å®šæ§åˆ¶å°
    close (unit=6)
    open(unit=6,file=&#39;CONOUT$&#39;)

    !è¾“å‡ºå­—ç¬¦ä¸²
    print &quot;(a)&quot;,str(1:len)
    hello = len
end  function 

integer function TestArray(arr,len)
    !GCC$ ATTRIBUTES CDECL,DLLEXPORT ::TestArray   
    integer(c_int), VALUE :: len
    integer i, arr(len)
    integer total

    total = 0
    do i = 1,len
        total = total + arr(i)
    end do

    arr(1) = 123
    TestArray = total
end  function  

end module test  
*/

fortran.buildShared(&quot;-o fortran.dll main.f95&quot;);
</code></pre>
<a href="javascript:if(confirm('https://www.aardio.com/zh-cn/doc/example/Languages/Fortran/buildShared.md  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª Ëü²»ÔÚÏîÄ¿ÎÄ¼şÀàĞÍ¹æ·¶ÄÚ¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.aardio.com/zh-cn/doc/example/Languages/Fortran/buildShared.md'" tppabs="https://www.aardio.com/zh-cn/doc/example/Languages/Fortran/buildShared.md">Markdown æ ¼å¼</a>
</body> 
</html>