
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="robots" content="index, follow">
<meta name='description' content='aardio 编程语言文档 - wsock.tcp.jsonClient 库模块帮助文档'>
<meta http-equiv='content-language' content='zh-cn'>
<title>aardio 编程语言文档 - wsock.tcp.jsonClient 库模块帮助文档</title> 
<link rel="stylesheet" href="../../../css/markdown.css" tppabs="https://www.aardio.com/zh-cn/doc/css/markdown.css">
<script src="../../../js/prism.js" tppabs="https://www.aardio.com/zh-cn/doc/js/prism.js"></script>
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css">
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css">
</head>
<body class="markdown-body"><a id="back-to-home" href="../../../index.htm" tppabs="https://www.aardio.com/zh-cn/doc/" title="aardio 编程语言文档首页"><i class="fas fa-home" id="home-icon"></i><i class="fas fa-robot" id="ai-icon" style="display: none;"></i><span id="aardio-document-home">aardio 文档</span></a>
<h1>wsock.tcp.jsonClient 库模块帮助文档</h1>

<p><a id="wsock.tcp"></a></p>

<h2>wsock.tcp 成员列表</h2>

<p><a id="wsock.tcp.jsonClient"></a></p>

<h3>wsock.tcp.jsonClient</h3>

<p>JSON-RPC 2.0 客户端<br>
aardio 输出的请求 JSON 不包含换行并以换行符&#39;<br>
&#39;结束。<br>
服务器应答 JSON 对象的 id 字段必须与请求 id 一致，<br>
在批量请求时应答数组应当包含 id 一致的对象（不需要返回空数组）<br>
<a href="http://www.jsonrpc.org/specification">关于 JSON-RPC 2.0</a></p>

<p><a id="wsock.tcp.jsonClient"></a></p>

<h3>wsock.tcp.jsonClient()</h3>

<p><a href="#wsockRpcJsonClientObject">返回对象:wsockRpcJsonClientObject</a></p>

<p><a id="wsock.tcp.jsonClient"></a></p>

<h3>wsock.tcp.jsonClient(主机,端口)</h3>

<p>创建REST客户端<br>
也可以在第一个参数中使用冒号分隔主机与端口</p>

<p><a id="wsockRpcJsonClientObject"></a></p>

<h2>wsockRpcJsonClientObject 成员列表</h2>

<p><a id="wsockRpcJsonClientObject.?"></a></p>

<h3>wsockRpcJsonClientObject.?</h3>

<p>远程对象名或远程方法名字。<br>
远程函数调用成功则第一个返回值为表对象，<br>
└── 该对象的 result 字段为返回值，error 为错误对象，两个字段不会同时存在。<br>
└── error 对象的 message 为错误信息，code 为错误代码，data 为错误附加数据。<br>
└── 如果存在 error 对象，则第 2 个返回值为 error 对象的 JSON 文本格式。<br>
调用失败第一个返回值为 null ，第二个返回值为错误信息  </p>

<p>如果调用 rpc.beginTrans 函数开始一个批量调用，<br>
则返回一个可以指定 end 成员函数的对象，服务器应答时自动回调此 end 函数  </p>

<p><a href="#wsockRpcJsonClientObject">返回对象:wsockRpcJsonClientObject</a></p>

<p><a id="wsockRpcJsonClientObject.process"></a></p>

<h3>wsockRpcJsonClientObject.process</h3>

<p>如果使用 process.rpc.tcpJsonClient 创建对象，<br>
则此属性为 process.popen 对象，否则为空。  </p>

<p><a href="https://www.aardio.com/zh-cn/doc/library-reference/process/popen.html#processPopenObject">返回对象:processPopenObject</a></p>

<p><a id="wsockRpcJsonClientObject.rpc"></a></p>

<h2>wsockRpcJsonClientObject.rpc 成员列表</h2>

<p>RPC本地客户端对象<br>
所以本地函数放在这个对象里面<br>
用户不得添加、删除、修改此对象的任何成员</p>

<p><a id="wsockRpcJsonClientObject.rpc.beforeRequest"></a></p>

<h3>wsockRpcJsonClientObject.rpc.beforeRequest(请求数据)</h3>

<pre><code class="aardio language-aardio">wsockRpcJsonClientObject.rpc.beforeRequest = function(reqData){
    /*此回调事件在发送请求前触发  
reqData.params是即将发送的参数*/
    return reqData;
}
</code></pre>

<p><a id="wsockRpcJsonClientObject.rpc.beginTrans"></a></p>

<h3>wsockRpcJsonClientObject.rpc.beginTrans()</h3>

<p>开始批量调用<br>
批量调用时单次调用的返回值是一个表<br>
可对返回值指定end成员函数，<br>
end函数会在commitTrans提交批量调用成功后被触发</p>

<p><a id="wsockRpcJsonClientObject.rpc.charset"></a></p>

<h3>wsockRpcJsonClientObject.rpc.charset</h3>

<p>获取或修改编码,默认为&quot;UTF-8&quot;,<br>
因为 JSON 规定了 Unicode 编码方案，所以不建议也不应该修改这个值  </p>

<p>如果指定为除&quot;UTF-8&quot;之外的值，则按本机默认代码页转换服务端编码</p>

<p><a id="wsockRpcJsonClientObject.rpc.client"></a></p>

<h3>wsockRpcJsonClientObject.rpc.client</h3>

<p>用于执行请求的 wsock.tcp.client 对象  </p>

<p><a href="client.html#tcpclientObject" tppabs="https://www.aardio.com/zh-cn/doc/library-reference/wsock/tcp/client.html#tcpclientObject">返回对象:tcpclientObject</a></p>

<p><a id="wsockRpcJsonClientObject.rpc.close"></a></p>

<h3>wsockRpcJsonClientObject.rpc.close()</h3>

<p>关闭RPC客户端并释放资源</p>

<p><a id="wsockRpcJsonClientObject.rpc.commitTrans"></a></p>

<h3>wsockRpcJsonClientObject.rpc.commitTrans()</h3>

<p>完成批量调用</p>

<p><a id="wsockRpcJsonClientObject.rpc.lastResponse"></a></p>

<h3>wsockRpcJsonClientObject.rpc.lastResponse()</h3>

<p>获取最后一次服务器返回的原始数据,<br>
如果控制台已打开或在开发环境中导入console库则在控制台输出数据<br>
下载文件时该值为空</p>

<p><a id="wsockRpcJsonClientObject.rpc.lastStatusCode"></a></p>

<h3>wsockRpcJsonClientObject.rpc.lastStatusCode</h3>

<p>获取最近一次请求返回的HTTP状态码<br>
100 ~ 101 为信息提示<br>
200 ~ 206 表示请求成功<br>
300 ~ 305 表示重定向<br>
400 ~ 415 表求客户端请求出错<br>
500 ~ 505 表示服务端错误</p>

<p><a id="wsockRpcJsonClientObject.rpc.lastStatusMessage"></a></p>

<h3>wsockRpcJsonClientObject.rpc.lastStatusMessage()</h3>

<p>获取最近返回的HTTP状态码文本描述<br>
第二个返回值为状态码</p>

<p><a id="wsockRpcJsonClientObject.rpc.notify"></a></p>

<h3>wsockRpcJsonClientObject.rpc.notify(&quot;函数名&quot;,参数)</h3>

<p>发送通知,服务器不返回值,<br>
如果 varargs 属性指定为 true 时将不定个数参数合为数组，<br>
varargs 为 false 时直接发送参数  </p>

<p>成功返回 true，失败返回 null,错误信息</p>

<p><a id="wsockRpcJsonClientObject.rpc.rollbackTrans"></a></p>

<h3>wsockRpcJsonClientObject.rpc.rollbackTrans()</h3>

<p>撤消尚未提交的批量调用</p>

<p><a id="wsockRpcJsonClientObject.rpc.setAuth"></a></p>

<h3>wsockRpcJsonClientObject.rpc.setAuth(&quot;用户名&quot;,&quot;密码&quot;)</h3>

<p>设置HTTP登录用户名,密码</p>

<p><a id="wsockRpcJsonClientObject.rpc.varargs"></a></p>

<h3>wsockRpcJsonClientObject.rpc.varargs</h3>

<p>默认值为 true,<br>
值为 true 时将不定个数的参数放入数组发送给服务端<br>
值为false时直接将单个参数发送给服务端  </p>

<p>JSON-RPC 2.0 一个会制造混乱的地方：<br>
如果 params 是一个数组，并没有规定是展开为一个参数，还是作为一个数组参数。  </p>

<p>目前aardio的RPC服务端会负责展开数组作为多个参数，<br>
但客户端需要在这里手动设置</p>

<p><a id="wsockRpcJsonClientObject.rpc.version"></a></p>

<h3>wsockRpcJsonClientObject.rpc.version</h3>

<p>值为 JSON-RPC 协议版本：&quot;2.0&quot;<br>
不应该修改这个值</p>

<p><a id="wsockRpcJsonClientObject.rpc.xcall"></a></p>

<h3>wsockRpcJsonClientObject.rpc.xcall(&quot;函数名&quot;,参数)</h3>

<p>调用远程函数。<br>
如果 varargs 属性指定为 true 时将不定个数参数合为数组，<br>
varargs 为 false 时直接发送参数  </p>

<p>远程函数调用成功则第一个返回值为表对象，<br>
└── 该对象的 result 字段为返回值，error 为错误对象，两个字段不会同时存在。<br>
└── error 对象的 message 为错误信息，code 为错误代码，data 为错误附加数据。<br>
└── 如果存在 error 对象，则第 2 个返回值为 error 对象的 JSON 文本格式。<br>
调用失败第一个返回值为 null ，第二个返回值为错误信息  </p>

<p>如果调用 rpc.beginTrans 函数开始一个批量调用，<br>
则返回一个可以指定 end 成员函数的对象，服务器应答时自动回调此 end 函数</p>

<p><a href="https://www.aardio.com/zh-cn/doc/library-reference/wsock/tcp/jsonClient.md">Markdown 格式</a></p>

</body> 
</html>