
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="robots" content="index, follow">
<meta name='description' content='aardio 编程语言文档 - web.script 库模块帮助文档'>
<meta http-equiv='content-language' content='zh-cn'>
<title>aardio 编程语言文档 - web.script 库模块帮助文档</title> 
<link rel="stylesheet" href="../../../css/markdown.css" tppabs="https://www.aardio.com/zh-cn/doc/css/markdown.css">
<script src="../../../js/prism.js" tppabs="https://www.aardio.com/zh-cn/doc/js/prism.js"></script>
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/fontawesome.min.css">
<link rel="stylesheet" href="../../../../../../lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css" tppabs="https://lib.baomitu.com/font-awesome/6.6.0/css/solid.min.css">
</head>
<body class="markdown-body"><a id="back-to-home" href="../../../index.htm" tppabs="https://www.aardio.com/zh-cn/doc/" title="aardio 编程语言文档首页"><i class="fas fa-home" id="home-icon"></i><i class="fas fa-robot" id="ai-icon" style="display: none;"></i><span id="aardio-document-home">aardio 文档</span></a>
<h1>web.script 库模块帮助文档</h1>

<p><details>  <summary>说明</summary>  <p>
web.script 使用 ScriptControl 控件。
而 ScriptControl 加载的脚本每行最好保持在 1000 字以内。
ScriptControl 控件的不同版本每行字数上限在 1000 字到 2000 字以内是安全的，
稳妥的方法是保证每行在 1000 字以内.</p>

<p>现在很多压综的 JS 都去掉了所有换行， 
建议用 aardio 提供的 java.yuiCompressor 重新压缩 JS。
java.yuiCompressor 已默认设置为单行上限 1000 字。
在扩展库管理器双击 java.yuiCompressor 可查看范例。</p>

<p>对于较新的 JS 如果 java.yuiCompressor 压缩失败。
可参考 aardio 自带 nodeJs 扩展库范例改用 uglify-js 压缩。
</p></details></p>

<p><a id="web"></a></p>

<h2>web 成员列表</h2>

<p><a id="web.script"></a></p>

<h3>web.script(&quot;ES6&quot;)</h3>

<p>创建 JavaScript（ES6） 脚本解释器。<br>
需要调用 Win10/Win11 自带 Chakra 组件。Win10 以下系统退化为 JScript。<br>
Chakra 与 web.form, web.mshtml 冲突，导入这些库时自动退化为 JScript。<br>
Chakra 支持 ES6，支持箭头函数，let,const,类等 ES6 语法。<br>
但不支持一些 JScript 专有的函数，例如 VBArray。<br>
对于 Chakra，ScriptEngine 等函数返回的版本信息是无意义的</p>

<p><a id="web.script"></a></p>

<h3>web.script(&quot;JScript&quot;)</h3>

<p>创建 JScript 脚本解释器<br>
参数可省略</p>

<p><a id="web.script"></a></p>

<h3>web.script(&quot;JScript9&quot;)</h3>

<p>创建 JScript9 脚本解释器。<br>
操作系统最低要求 Win10/Win11，<br>
Win10 以下系统退化为 JScript。</p>

<p><a id="web.script"></a></p>

<h3>web.script(&quot;VBScript&quot;)</h3>

<p>创建 VBScript 脚本解释器</p>

<p><a id="web.script"></a></p>

<h3>web.script()</h3>

<p>创建 JScript 脚本解释器  </p>

<p><a href="#webScriptObject">返回对象:webScriptObject</a></p>

<p><a id="web.script"></a></p>

<h2>web.script 成员列表</h2>

<p><a id="web.script.eval"></a></p>

<h3>web.script.eval()</h3>

<p>计算并返回参数@1中 JScript 代码指定的表达式的值,<br>
如果有多个参数,则调用 string.format 格式化所有参数获取要执行的脚本代码</p>

<p><a id="web.script.preload"></a></p>

<h3>web.script.preload</h3>

<p>此名字空间下的对象用于添加初始化脚本,<br>
每个初始化脚本对象必须包含以下字段:<br>
language 一个表,键为小写的脚本语言名称,值为 true 则支持该语言,<br>
code 指定要加载的脚本代码  </p>

<p>具体用法请参考 web.script.json 源码</p>

<p><a id="webScriptFuncObject"></a></p>

<h2>webScriptFuncObject 成员列表</h2>

<p><a id="webScriptFuncObject.HasReturnValue"></a></p>

<h3>webScriptFuncObject.HasReturnValue</h3>

<p>是否有返回值</p>

<p><a id="webScriptFuncObject.Name"></a></p>

<h3>webScriptFuncObject.Name</h3>

<p>函数名字</p>

<p><a id="webScriptFuncObject.NumArgs"></a></p>

<h3>webScriptFuncObject.NumArgs</h3>

<p>参数数目</p>

<p><a id="webScriptObject"></a></p>

<h2>webScriptObject 成员列表</h2>

<p><a id="webScriptObject.?"></a></p>

<h3>webScriptObject.?</h3>

<p>可直接赋值为 aardio 对象或函数以允许脚本调用，<br>
在这里写入数组属性时，会自动调用 createArray 转换  </p>

<p>注意如果只是要读写脚本中的变量值，应通过 script 属性读写</p>

<p><a id="webScriptObject.addCode"></a></p>

<h3>webScriptObject.addCode(&quot;字符串参数&quot;)</h3>

<p>添加脚本代码,<br>
调用这个函数的作用等价于直接对 script 属性赋值</p>

<p><a id="webScriptObject.allowUi"></a></p>

<h3>webScriptObject.allowUi</h3>

<p>是否允许消息框等界面元素</p>

<p><a id="webScriptObject.createArray"></a></p>

<h3>webScriptObject.createArray()</h3>

<p>参数传入 aardio 数组，转换为当前脚本支持的数组对象</p>

<p><a id="webScriptObject.doScript"></a></p>

<h3>webScriptObject.doScript(&quot;字符串参数&quot;)</h3>

<p>添加脚本代码<br>
参数可以是脚本代码、脚本文件路径，<br>
如果事先引入 inet.http 库，就可以在参数中指定脚本网址</p>

<p><a id="webScriptObject.error"></a></p>

<h3>webScriptObject.error</h3>

<p>发生错误时此属性返回错误对象</p>

<p><a id="webScriptObject.eval"></a></p>

<h3>webScriptObject.eval()</h3>

<p>计算并返回参数@1中脚本代码指定的表达式的值,<br>
如果有多个参数,则调用 string.format 格式化所有参数获取要执行的脚本代码</p>

<p><a id="webScriptObject.executeStatement"></a></p>

<h3>webScriptObject.executeStatement(&quot;字符串参数&quot;)</h3>

<p>执行代码,无返回值</p>

<p>执行代码,无返回值</p>

<p><a id="webScriptObject.jsConstructor"></a></p>

<h3>webScriptObject.jsConstructor(&quot;Array&quot;)</h3>

<p>获取 JS 使用 new 语句创建对象的构造函数。<br>
参数 @1 可以是 JS 对象，或字符串类型的对象名字。  </p>

<p>调用返回的构造函数时：<br>
构造参数包含 COM 对象则直接传参，否则使用 JSON 转换为纯 JS 参数。</p>

<p><a id="webScriptObject.jsNew"></a></p>

<h3>webScriptObject.jsNew(&quot;Array&quot;)</h3>

<p>调用 JS 的 new 语句构造 JS 对象。<br>
参数 @1 可以是 JS 对象，或字符串类型的对象名字。<br>
可指定一个或多个构造参数。<br>
构造参数包含 COM 对象则直接传参，否则使用 JSON 转换为纯 JS 参数。</p>

<p><a id="webScriptObject.json"></a></p>

<h3>webScriptObject.json</h3>

<p>通过此对象的成员可调用 JavaScript 脚本中的同名全局函数,<br>
也可在下标操作符中用一个指向函数对象的 JS 表达式以获取对应的调用函数，<br>
参数自动转换为 JSON（支持单个参数），返回值自动解析 JSON  </p>

<p>也可以将此对象作为函数调用，<br>
传入 aardio 对象自动转换为 JScript 对象，<br>
传入 JScript 对象时则返回 aardio 对象。  </p>

<p>web.script.es6 直接支持 json 对象</p>

<p><a id="webScriptObject.language"></a></p>

<h3>webScriptObject.language</h3>

<p>设置或获取正在使用的 Script 语言名称<br>
 可选值&quot;VBScript&quot;,&quot;JScript&quot;。<br>
注意 &quot;ES6&quot;，&quot;JScript9&quot; 只能在 web.script 构造函数里指定</p>

<p><a id="webScriptObject.modules"></a></p>

<h3>webScriptObject.modules</h3>

<p>组件模块集合<br>
可使用 com.each 迭代器遍历</p>

<p><a id="webScriptObject.procedures"></a></p>

<h3>webScriptObject.procedures()</h3>

<p><a href="#webScriptFuncObject">返回对象:webScriptFuncObject</a></p>

<p><a id="webScriptObject.procedures"></a></p>

<h3>webScriptObject.procedures(序号)</h3>

<p>模块中定义函数的集合</p>

<p><a id="webScriptObject.reset"></a></p>

<h3>webScriptObject.reset()</h3>

<p>重置脚本虚拟机,丢弃所有对象和代码<br>
并将State属性设为0</p>

<p><a id="webScriptObject.script"></a></p>

<h3>webScriptObject.script</h3>

<p>获取属性时返回脚本对象<br>
通过此对象可直接调用脚本中的函数,  </p>

<p>写入属性时应使用字符串指定脚本代码,相当于调用 doScript 函数,<br>
多次写入此属性是添加脚本不是覆盖替换脚本</p>

<p><a id="webScriptObject.script.?"></a></p>

<h3>webScriptObject.script.?</h3>

<p>读写脚本中的对象，<br>
可调用脚本函数并返回值,支持不定个数参数  </p>

<p>调用 Chakra（ES6）函数时不支持无参数函数，但可通 json 属性调用</p>

<p><a id="webScriptObject.siteHwnd"></a></p>

<h3>webScriptObject.siteHwnd</h3>

<p>脚本中显示UI的父窗口句柄</p>

<p><a id="webScriptObject.state"></a></p>

<h3>webScriptObject.state</h3>

<p>为0不转发事件<br>
为1则转发事件</p>

<p><a id="webScriptObject.timeOut"></a></p>

<h3>webScriptObject.timeOut</h3>

<p>脚本超时时间,以毫秒为单位,默认为-1表示不超时,<br>
如设置超时脚本运行太久会弹出是否继续运行的对话框</p>

<p><a id="webScriptObject.useSafeSubset"></a></p>

<h3>webScriptObject.useSafeSubset</h3>

<p>脚本控件是否限制运行未被标记为“脚本安全”的组件</p>

<p><a id="webScriptObject.xcall"></a></p>

<h3>webScriptObject.xcall(&quot;函数名&quot;,参数)</h3>

<p>运行 JS 函数，<br>
Chakra（ES6）不支持无参数函数，但可通 json 属性调用</p>

<p><a href="javascript:if(confirm('https://www.aardio.com/zh-cn/doc/library-reference/web/script/_.md  \n\nļ޷ Teleport Ultra , Ϊ ʵļصġ  \n\nڷϴ?'))window.location='https://www.aardio.com/zh-cn/doc/library-reference/web/script/_.md'" tppabs="https://www.aardio.com/zh-cn/doc/library-reference/web/script/_.md">Markdown 格式</a></p>

</body> 
</html>